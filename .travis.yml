sudo: required
services:
- docker
before_install:
- openssl aes-256-cbc -K $encrypted_95b2b80a4aa4_key -iv $encrypted_95b2b80a4aa4_iv
  -in credentials.enc -out credentials -d
- source credentials
- sudo apt update -y
- sudo apt install --only-upgrade docker-ce -y
script:
- export REPO=dynverse/dynwrap$NAME
- source version
- sudo docker build --build-arg GITHUB_PAT=${GITHUB_PAT} -t $REPO:v$VERSION .
- docker tag $REPO:v$VERSION $REPO:latest
after_success:
- if [[ "$TRAVIS_BRANCH" == "master" ]]; then docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD ; docker push $REPO ; fi
jobs:
  include:
    - stage: r
      env:
      - NAME=dynwrapr
    - stage: py
      env:
      - NAME=dynwrappy2
    - stage: py
      env:
      - NAME=dynwrappy3
